# graph-app deployment (Kubernetes)

- helm repo add bitnami https://charts.bitnami.com/bitnami
- kubectl create namespace graph-app
- helm install kafka bitnami/kafka --namespace graph-app
- helm install postgres bitnami/postgresql --namespace graph-app
- export POSTGRES_PASSWORD=$(kubectl get secret --namespace graph-app postgres-postgresql -o jsonpath="{.data.postgres-password}" | base64 --decode)
- kubectl run postgres-postgresql-client --rm --tty -i --restart='Never' --namespace graph-app  
  --image docker.io/bitnami/postgresql:14.1.0-debian-10-r80 --env="PGPASSWORD=$POSTGRES_PASSWORD"  
  --command -- psql -h postgres-postgresql -U postgres -c "CREATE DATABASE \"vertex_registry\";"
- kubectl run postgres-postgresql-client --rm --tty -i --restart='Never' --namespace graph-app \
  --image docker.io/bitnami/postgresql:14.1.0-debian-10-r80 --env="PGPASSWORD=$POSTGRES_PASSWORD" \
  --command -- psql -h postgres-postgresql -U postgres -c "CREATE DATABASE path_finder;"
- helm install redis bitnami/redis --namespace graph-app
- cd graph-path-finding-service
- helm upgrade --install graph-path-finding-service ./helm/graph-path-finding-service/ --set image.tag=${latest-tag}
- cd ../vertex-registry
- helm upgrade --install vertex-registry ./helm/vertex-registry/ --set image.tag=${latest-tag} -n graph-app
- Look up external ip of both services: kubectl get svc -n graph-app
- build graph-ui image with proper IPs set in .env file
- cd ../graph-ui
- helm upgrade --install graph-ui ./helm/graph-ui/ --set image.tag=${latest-tag} -n graph-app
